flowchart TD

    %% Background Styling
    classDef background fill:#202020,stroke:#333,stroke-width:2px,color:#ffffff;

    %% Data Collection (Top-Centered)
    subgraph DC["🔍 1. Data Collection"]
        direction TB
        class DC background;
        B["📱 Benign APKs"]
        M["⚠️ Malicious APKs"]
    end

    %% Static Analysis (Left)
    subgraph SA["🛠 2. Static Analysis"]
        direction TB
        class SA background;
        AD["📦 APK Decompilation"]
        FE["🔎 Feature Extraction"]
        MT["📊 Model Training"]
        DR["📌 Initial Detection"]
    end

    %% Dynamic Analysis (Right)
    subgraph DA["⚡ 3. Dynamic Analysis"]
        direction TB
        class DA background;
        AI["📲 APK Installation"]
        RM["📡 Runtime Monitoring"]
        
        subgraph RM_Elements["🔍 Monitoring Elements"]
            direction LR
            API["📞 API Calls"]
            PU["🔑 Permissions"]
            SL["⚠️ Logs"]
            BD["🔋 Battery & CPU"]
        end
        
        BFE["🧪 Behavioral Features"]
        SDR["📌 Secondary Detection"]
    end

    %% Combined Classification (Center)
    subgraph CC["🔄 4. Combined Classification"]
        direction TB
        class CC background;
        SA_DA["🔀 Static + Dynamic Merge"]
        FD{{"🎯 Final Decision"}}
        
        subgraph Dec["✅❌ Decision Outcomes"]
            direction LR
            Ben["✅ Benign"]
            Mal["❌ Malicious"]
        end
    end

    %% User Platform (Bottom-Centered)
    subgraph UP["🚀 5. User-Friendly Platform"]
        direction TB
        class UP background;
        UU["📤 User Uploads APK"]
        RSD["🔄 Real-time Analysis"]
        MCR{{"🚦 Classification Result"}}
        
        subgraph Res["📢 User Feedback"]
            direction TB
            Ben2["✅ Benign - Safe to Install"]
            Mal2["❌ Malicious (Risk Factors)"]
        end
    end

    %% Connections (Symmetrically Balanced)
    B --> AD
    M --> AD
    M --> AI
    
    AD --> FE
    FE --> MT
    MT --> DR

    AI --> RM
    RM --- API & PU & SL & BD
    RM --> BFE
    BFE --> SDR

    DR --> SA_DA
    SDR --> SA_DA
    SA_DA --> FD
    FD --> Ben & Mal

    FD --> UP
    UU --> RSD
    RSD --> MCR
    MCR --> Ben2
    MCR --> Mal2

    %% Styling for Visual Appeal
    classDef processNode fill:#455A64,stroke:#1a5fb4,stroke-width:2px,color:#fff,rounded:10px;
    classDef decisionNode fill:#FF9800,stroke:#c64600,stroke-width:2px,color:#fff,rounded:15px;
    classDef subgraphStyle fill:#37474F,stroke:#f5f5f5,stroke-width:1px,color:#f5f5f5,rounded:10px;
    classDef positiveNode fill:#4CAF50,stroke:#26a269,stroke-width:1px,color:#fff,rounded:5px;
    classDef negativeNode fill:#F44336,stroke:#c01c28,stroke-width:1px,color:#fff,rounded:5px;

    class AD,FE,MT,AI,RM,BFE,UU,RSD processNode;
    class DR,SDR,FD,MCR decisionNode;
    class Ben,Ben2 positiveNode;
    class Mal,Mal2 negativeNode;
    class DC,SA,DA,CC,UP subgraphStyle;
